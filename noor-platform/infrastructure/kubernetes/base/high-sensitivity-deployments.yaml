apiVersion: apps/v1
kind: Deployment
metadata:
  name: biometric-identity-service
  namespace: noor-high-sensitivity
  labels:
    app: biometric-identity
    pool: high-sensitivity
    tier: service
    security: critical
spec:
  replicas: 3
  selector:
    matchLabels:
      app: biometric-identity
  template:
    metadata:
      labels:
        app: biometric-identity
        pool: high-sensitivity
        tier: service
        security: critical
    spec:
      nodeSelector:
        pool: high-sensitivity
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                  - key: app
                    operator: In
                    values:
                      - biometric-identity
              topologyKey: kubernetes.io/hostname
      containers:
        - name: biometric-identity
          image: noor-backend:latest
          imagePullPolicy: Always
          ports:
            - containerPort: 8006
              name: http
          env:
            - name: SERVICE_NAME
              value: "biometric-identity"
            - name: SERVICE_PORT
              value: "8006"
          envFrom:
            - configMapRef:
                name: noor-config
            - secretRef:
                name: noor-secrets
          resources:
            requests:
              cpu: 1000m
              memory: 2Gi
            limits:
              cpu: 2000m
              memory: 4Gi
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            readOnlyRootFilesystem: true
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                - ALL
          livenessProbe:
            httpGet:
              path: /health
              port: 8006
            initialDelaySeconds: 60
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3
          readinessProbe:
            httpGet:
              path: /ready
              port: 8006
            initialDelaySeconds: 30
            periodSeconds: 5
            timeoutSeconds: 3
            failureThreshold: 3
---
apiVersion: v1
kind: Service
metadata:
  name: biometric-identity-service
  namespace: noor-high-sensitivity
spec:
  selector:
    app: biometric-identity
  ports:
    - protocol: TCP
      port: 8006
      targetPort: 8006
  type: ClusterIP
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: health-certification-service
  namespace: noor-high-sensitivity
  labels:
    app: health-certification
    pool: high-sensitivity
    tier: service
    security: critical
spec:
  replicas: 3
  selector:
    matchLabels:
      app: health-certification
  template:
    metadata:
      labels:
        app: health-certification
        pool: high-sensitivity
        tier: service
        security: critical
    spec:
      nodeSelector:
        pool: high-sensitivity
      containers:
        - name: health-certification
          image: noor-backend:latest
          imagePullPolicy: Always
          ports:
            - containerPort: 8005
              name: http
          env:
            - name: SERVICE_NAME
              value: "health-certification"
            - name: SERVICE_PORT
              value: "8005"
          envFrom:
            - configMapRef:
                name: noor-config
            - secretRef:
                name: noor-secrets
          resources:
            requests:
              cpu: 500m
              memory: 1Gi
            limits:
              cpu: 1000m
              memory: 2Gi
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            readOnlyRootFilesystem: true
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                - ALL
          livenessProbe:
            httpGet:
              path: /health
              port: 8005
            initialDelaySeconds: 30
            periodSeconds: 10
          readinessProbe:
            httpGet:
              path: /ready
              port: 8005
            initialDelaySeconds: 15
            periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: health-certification-service
  namespace: noor-high-sensitivity
spec:
  selector:
    app: health-certification
  ports:
    - protocol: TCP
      port: 8005
      targetPort: 8005
  type: ClusterIP
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: payroll-pensions-service
  namespace: noor-high-sensitivity
  labels:
    app: payroll-pensions
    pool: high-sensitivity
    tier: service
    security: critical
spec:
  replicas: 3
  selector:
    matchLabels:
      app: payroll-pensions
  template:
    metadata:
      labels:
        app: payroll-pensions
        pool: high-sensitivity
        tier: service
        security: critical
    spec:
      nodeSelector:
        pool: high-sensitivity
      containers:
        - name: payroll-pensions
          image: noor-backend:latest
          imagePullPolicy: Always
          ports:
            - containerPort: 8002
              name: http
          env:
            - name: SERVICE_NAME
              value: "payroll-pensions"
            - name: SERVICE_PORT
              value: "8002"
          envFrom:
            - configMapRef:
                name: noor-config
            - secretRef:
                name: noor-secrets
          resources:
            requests:
              cpu: 1000m
              memory: 2Gi
            limits:
              cpu: 2000m
              memory: 4Gi
          securityContext:
            runAsNonRoot: true
            runAsUser: 1000
            readOnlyRootFilesystem: true
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                - ALL
          livenessProbe:
            httpGet:
              path: /health
              port: 8002
            initialDelaySeconds: 30
            periodSeconds: 10
          readinessProbe:
            httpGet:
              path: /ready
              port: 8002
            initialDelaySeconds: 15
            periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: payroll-pensions-service
  namespace: noor-high-sensitivity
spec:
  selector:
    app: payroll-pensions
  ports:
    - protocol: TCP
      port: 8002
      targetPort: 8002
  type: ClusterIP
